if(typeof Meio=="undefined"){var Meio={}}$extend(Element.NativeEvents,{"paste":2,"input":2});Element.Events.paste={base:(Browser.Engine.presto||(Browser.Engine.gecko&&Browser.Engine.version<19))?"input":"paste",condition:function(A){this.fireEvent("paste",A,1);return false}};Meio.Mask=new Class({Implements:[Options,Events],eventsToBind:["focus","blur","keydown","keypress","paste"],options:{selectOnFocus:true,autoTab:false},initialize:function(B,A){this.element=$(B);if(this.element.get("tag")!=="input"||this.element.get("type")!=="text"){return }this.setup(A)},setup:function(A){this.setOptions(A);if(this.options.mask){if(this.element.retrieve("meiomask")){this.remove()}var C=this.element.get("value");if(C!==""){var B=C.meiomask(this.constructor,this.options);this.element.set("value",B).defaultValue=B}this.ignore=false;this.masklength=this.element.get("maxlength");this.maskArray=this.options.mask.split("");this.eventsToBind.each(function(D){this.element.addEvent(D,this._onMask.bindWithEvent(this,this["_"+D]))},this);this.element.store("meiomask",this).erase("maxlength")}return this},remove:function(){var B=this.element.retrieve("meiomask");if(B){var A=B.options.maxlength;if(A!==null){this.element.set("maxlength",A)}B.eventsToBind.each(function(C){this.element.removeEvent(C,this[C+"Event"])},B)}return this},_onMask:function(B,A){if(this.element.get("readonly")){return true}var C={};C.range=this.element.getRange();C.isSelection=(C.range.start!==C.range.end);C.isDelKey=(B.code==46);C.isBksKey=(B.code==8||(Browser.Platform.ipod&&B.code==127));C.isRemoveKey=(C.isBksKey||C.isDelKey);A.call(this,B,C);return true},_keydown:function(A,B){this.ignore=(A.code in Meio.Mask.ignoreKeys);if(this.ignore){this.fireEvent("valid",[this.element,A.code])}(Browser.Platform.ipod||(Meio.Mask.onlyKeyDownRepeat&&B.isRemoveKey))?this._keypress(A,B):true},_focus:function(A,B){if(this.options.selectOnFocus){this.element.select()}},testEntry:function(D,A){var C=this.maskArray,E=Meio.Mask.rules[C[D]],B=(E&&E.regex.test(A));return(E.check&&B)?E.check(this.element.get("value"),D,A):B},testEvents:function(C,A,D,F){var B=this.maskArray,E=Meio.Mask.rules[B[C]],G;if(!F){if(!E){this.fireEvent("overflow",[this.element,D,A]);return false}else{if(!(G=this.testEntry(C,A))){this.fireEvent("invalid",[this.element,D,A]);return false}}}this.fireEvent("valid",[this.element,D,A]);return G||true},setSize:function(){if(!this.element.get("size")){this.element.set("size",this.maskArray.length)}},isFixedChar:function(A){return !Meio.Mask.matchRules.contains(A)}});Meio.Mask.extend({matchRules:"",rulesRegex:new RegExp(),rules:{},setRule:function(A,B){this.setRules({ruleKey:B})},setRules:function(A){$extend(this.rules,A);var B=[];for(rule in A){B.push(rule)}this.matchRules+=B.join("");this.recompileRulesRegex()},removeRule:function(A){delete this.rules[A];this.matchRules=this.matchRules.replace(A,"");this.recompileRulesRegex()},removeRules:function(){var A=Array.flatten(arguments);for(var B=A.length;B--;){this.removeRule(A[B])}},recompileRulesRegex:function(){this.rulesRegex.compile("["+this.matchRules.escapeRegExp()+"]","g")},createMasks:function(B,A){B=B.capitalize();for(mask in A){Meio.Mask[B][mask.camelCase().capitalize()]=new Class({Extends:Meio.Mask[B],options:A[mask]})}},upTo:function(A){A=String(A);return function(D,C,B){if(D.charAt(C-1)==A[0]){return(B<=A[1])}return true}},onlyKeyDownRepeat:(Browser.Engine.trident||(Browser.Engine.webkit&&Browser.Engine.version>=525))}).extend(function(){var B;var D={9:"tab",13:"enter",16:"shift",17:"control",18:"alt",27:"esc",33:"page up",34:"page down",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",224:"command"},C={10:"go"};if(Browser.Platform.ipod){B=C}else{for(var A=1;A<=12;A++){D[111+A]="f"+A}B=D}return{ignoreKeys:B}}()).setRules((function(){var B={"z":{regex:/[a-z]/},"Z":{regex:/[A-Z]/},"a":{regex:/[a-zA-Z]/},"*":{regex:/[0-9a-zA-Z]/},"@":{regex:/[0-9a-zA-ZçáàãâéèêíìóòõôúùüñÇÁÀÃÂÉÈÊÍÌÓÒÕÔÚÙÜÑ]/},"h":{regex:/[0-9]/,check:Meio.Mask.upTo(23)},"d":{regex:/[0-9]/,check:Meio.Mask.upTo(31)},"m":{regex:/[0-9]/,check:Meio.Mask.upTo(12)}};for(var A=0;A<=9;A++){B[A]={regex:new RegExp("[0-"+A+"]")}}return B})());Meio.Mask.Fixed=new Class({Extends:Meio.Mask,options:{placeholder:"_",autoSetSize:false,removeIfInvalid:false,removeInvalidTrailingChars:true},initialize:function(B,A){this.parent(B,A);this.maskMold=this.element.get("value")||this.options.mask.replace(Meio.Mask.rulesRegex,this.options.placeholder);this.maskMoldArray=this.maskMold.split("");this.validIndexes=[];if(this.options.autoSetSize){this.setSize()}this.maskArray.each(function(D,C){if(!this.isFixedChar(D)){this.validIndexes.push(C)}},this);this.createUnmaskRegex()},createUnmaskRegex:function(){var A=[].combine(this.options.mask.replace(Meio.Mask.rulesRegex,"").split(""));this.unmaskRegex=new RegExp("["+A.join("").escapeRegExp()+"]","g")},_applyMask:function(G,D){var A=G.split(""),C=this.maskArray,E=this.maskMold,B=0,F;while(B<E.length){if(!A[B]){A[B]=E[B]}else{if(Meio.Mask.rules[C[B]]){if(!(F=this.testEntry(B,A[B]))){A.splice(B,1);continue}else{if($type(F)==="string"){A[B]=F}}newStartRange=B}else{if(C[B]!=A[B]){A.splice(B,0,E[B])}else{A[B]=E[B]}}}B++}return{value:A.slice(0,this.maskMold.length),rangeStart:D+1}},_removeInvalidTrailingChars:function(D){var B=D.length,C=D.length-1,A;while(C>=0){A=false;while(this.isFixedChar(D.charAt(C))&&D.charAt(C)!==this.options.placeholder){A=true;C--}while(D.charAt(C)===this.options.placeholder){A=true;B=C;C--}if(!A){break}}this.element.set("value",D.substring(0,B))},_paste:function(B,C){B.preventDefault();var A=this._applyMask(this.element.get("value"),C.range.start);this.maskMoldArray=A.value;this.element.set("value",this.maskMoldArray.join("")).setRange(A.rangeStart)},_focus:function(A,B){this.element.set("value",this.maskMoldArray.join("")).store("meiomask:focusvalue",this.element.get("value"));this.parent(A,B)},_blur:function(A,C){var B=this.element.get("value");if(this.element.retrieve("meiomask:focusvalue")!=B){this.element.fireEvent("change")}if(this.options.removeIfInvalid){if(B.contains(this.options.placeholder)){this.maskMoldArray=this.maskMold.split("");this.element.set("value","")}return true}if(this.options.removeInvalidTrailingChars){this._removeInvalidTrailingChars(B)}return true},_keypress:function(J,D){if(this.ignore||J.control||J.meta||J.alt){return true}J.preventDefault();var K=String.fromCharCode(J.code),E=this.maskArray,C,G,B;if(!D.isSelection){var H;if(D.isBksKey){do{C=this.validIndexes.indexOf(--D.range.start)}while(C===-1&&D.range.start>=0);H=this.validIndexes[C]||0}else{do{C=this.validIndexes.indexOf(D.range.start++)}while(C===-1&&D.range.start<E.length);H=this.validIndexes[C+1]}G=this.validIndexes[C];if(!(B=this.testEvents(G,K,J.code,D.isRemoveKey))){return true}if($type(B)==="string"){K=B}this.maskMoldArray[G]=(D.isRemoveKey)?this.options.placeholder:K;this.element.set("value",this.maskMoldArray.join("")).setRange($pick(H,this.maskMoldArray.length))}else{var A=D.range.start,I=D.range.end,F;do{C=this.validIndexes.indexOf(D.range.start++)}while(C===-1&&D.range.start<E.length);do{F=this.validIndexes.indexOf(D.range.end++)}while(F===-1&&D.range.end<E.length);if(!(F-C)){return true}for(G=A;G<I;G++){this.maskMoldArray[G]=this.maskMold.charAt(G)}if(!D.isRemoveKey){G=this.validIndexes[C];if(!(B=this.testEvents(G,K,J.code,D.isRemoveKey))){return true}if($type(B)==="string"){K=B}this.maskMoldArray[G]=K;C++}this.element.set("value",this.maskMoldArray.join(""));this.element.setRange(this.validIndexes[C])}return true},mask:function(A){return this._applyMask(A).value.join("")},unmask:function(A){return A.replace(this.unmaskRegex,"")}});Meio.Mask.createMasks("Fixed",{"Phone":{mask:"(99) 9999-9999"},"PhoneUs":{mask:"(999) 999-9999"},"Cpf":{mask:"999.999.999-99"},"Cnpj":{mask:"99.999.999/9999-99"},"Date":{mask:"3d/1m/9999"},"DateUs":{mask:"1m/3d/9999"},"Cep":{mask:"99999-999"},"Time":{mask:"2h:59"},"CC":{mask:"9999 9999 9999 9999"}});Meio.Mask.DumbInput=new Element("input",{"type":"text"});(function(){var A=function(C){return C.camelCase().capitalize()};var B=function(E){var F=[];E=Array.link(E,{mask:String.type,type:String.type,options:Object.type,klass:Class.type});if(E.mask){F=E.mask.contains(".")?E.mask.split("."):[E.type,E.mask]}var C=E.klass||Meio.Mask[A(F[0])][A(F[1])],D=E.options||{};return{klass:C,options:D}};String.implement({meiomask:function(){var C=B(arguments);return new C.klass(Meio.Mask.DumbInput,C.options).mask(this)},meiounmask:function(){var C=B(arguments);return new C.klass(Meio.Mask.DumbInput,C.options).unmask(this)}});Element.Properties.meiomask={set:function(){var C=B(arguments);return this.store("meiomask",new C.klass(this,C.options))},get:function(){return this.retrieve("meiomask")},erase:function(){var C=this.retrieve("meiomask");if(C){C.remove()}return this}};Element.Properties.maxLength=Element.Properties.maxlength={set:function(C){this.setAttribute("maxLength",C);return this},get:function(){var C=this.getAttribute("maxLength",2);return(C===2147483647)?null:C},erase:function(){this.removeAttribute("maxLength");return this}};Element.implement({meiomask:function(C,E,D){return this.set("meiomask",C,E,D)},setRange:function(E,C){C=$pick(C,E);if(this.setSelectionRange){this.setSelectionRange(E,C)}else{var D=this.createTextRange();D.collapse();D.moveStart("character",E);D.moveEnd("character",C-E);D.select()}},getRange:function(){if(!Browser.Engine.trident){return{start:this.selectionStart,end:this.selectionEnd}}var D={start:0,end:0},C=document.selection.createRange();D.start=0-C.duplicate().moveStart("character",-100000);D.end=D.start+C.text.length;return D}})})()