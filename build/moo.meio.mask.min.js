if(typeof Meio=="undefined"){var Meio={}}$extend(Element.NativeEvents,{"paste":2,"input":2});Element.Events.paste={base:(Browser.Engine.presto||(Browser.Engine.gecko&&Browser.Engine.version<19))?"input":"paste",condition:function(A){this.fireEvent("paste",A,1);return false}};Meio.MaskGlobals={get:function(){if(!this.inited){var A=this,B,C=[];this.ignoreKeys=(Browser.Platform.ipod)?this.iphoneIgnoreKeys:this.ignoreKeys;for(B=0;B<=9;B++){this.rules[B]={regex:new RegExp("[0-"+B+"]")}}for(B in this.rules){C.push(B)}this.matchRules=C.join("");this.rulesRegex=new RegExp("["+this.matchRules.escapeRegExp()+"]","g");this.onlyKeyDownRepeat=(Browser.Engine.trident||(Browser.Engine.webkit&&Browser.Engine.version>=525));this.inited=true}return this},reset:function(){this.inited=false;return this.get()},setRule:function(A,B){if(A.length>1){return }this.rules[A]=B;this.matchRules+=A;this.rulesRegex.compile(this.matchRules.escapeRegExp(),"g")},setRules:function(A){for(rule in A){this.setRule(rule,A[rule])}},removeRule:function(A){delete this.rules[A];this.matchRules=this.matchRules.replace(A,"");this.rulesRegex.compile(this.matchRules.escapeRegExp(),"g")},removeRules:function(){var A=Array.flatten(arguments);for(var B=0;B<A.length;B++){this.removeRule(A[B])}},rules:{"z":{regex:/[a-z]/},"Z":{regex:/[A-Z]/},"a":{regex:/[a-zA-Z]/},"*":{regex:/[0-9a-zA-Z]/},"@":{regex:/[0-9a-zA-ZçÇáàãâéèêíìóòõôúùü]/},"c":{regex:/[0-9]/,check:function(C,B,A){if(C.charAt(B-1)==2){return(A<=3)}return true}}},ignoreKeys:[9,13,16,17,18,27,33,34,35,36,37,38,39,40,45,116,123,224],iphoneIgnoreKeys:[10],masks:{"phone":{mask:"(99) 9999-9999)"},"phone-us":{mask:"(999) 999-9999"},"cpf":{mask:"999.999.999-99"},"cnpj":{mask:"99.999.999/9999-99"},"date":{mask:"39/19/9999"},"date-us":{mask:"19/39/9999"},"cep":{mask:"99999-999"},"time":{mask:"2c:59"},"cc":{mask:"55 99"},"integer":{mask:"999.999.999.999",type:"reverse",decimal:false},"decimal":{mask:"999.999.999.999,99",type:"reverse"},"decimal-us":{mask:"999,999,999,999.99",type:"reverse"}}};Meio.Mask=new Class({Implements:[Options,Events],options:{attr:"alt",mask:null,type:"fixed",setSize:false,selectOnFocus:true,autoTab:true},initialize:function(B,A){this.element=$(B);if(this.element.get("tag")!="input"||this.element.get("type")!="text"){return }this.globals=Meio.MaskGlobals.get();this.change(A)},change:function(B){B=$pick(B,{});if(B.attr){this.options.attr=B.attr}var E=this.element.get(this.options.attr),A;A=($type(B)=="string")?B:(E)?E:null;if(A){this.options.mask=A}if(this.globals.masks[this.options.mask]){this.setOptions(this.globals.masks[this.options.mask])}if(JSON){this.setOptions(JSON.decode(A,true))}if($type(B)=="object"){this.setOptions(B)}if(this.options.mask){if(this.element.retrieve("meiomask")){this.remove()}var C=this.element.get("maxlength");this.setOptions({maxlength:C,maskArray:this.options.mask.split("")});var F=this.element.get("value");if(F!=""){var D=F.mask(this.options);this.element.defaultValue=D;this.element.value=D}this.element.store("meiomask",this).erase("maxlength");this.maskType=new Meio.MaskType[this.options.type](this)}return this},remove:function(){var B=this.element.retrieve("mask");if(B){var A=B.options.maxlength;if(A!=null){this.element.set("maxlength",A)}B.maskType.eventsToBind.each(function(C){this.element.removeEvent(C,this[C+"Event"])},B.maskType)}return this}});Meio.MaskType=new Class({initialize:function(A){this.ignore=false;if(A){this.mask=A;this.globals=A.globals;this.element=A.element;this.eventsToBind=["focus","blur","keydown","keypress","paste"];this.eventsToBind.each(function(B){this[B+"Event"]=this._onMask.bindWithEvent(this,this["_"+B]);this.element.addEvent(B,this[B+"Event"])},this)}},_onMask:function(B,A){var C={};if(this.element.get("readonly")){return true}C.range=this.element.getSelectedRange();C.isSelection=(C.range.start!=C.range.end);C.isDelKey=(B.code==46);C.isBksKey=(B.code==8||(Browser.Platform.ipod&&B.code==127));C.isRemoveKey=(C.isBksKey||C.isDelKey);return A.call(this,B,C)},_keydown:function(A,B){this.ignore=this.globals.ignoreKeys.contains(A.code);if(this.ignore){this.mask.fireEvent("valid",[this.element,A.code])}return(Browser.Platform.ipod||(this.globals.onlyKeyDownRepeat&&B.isRemoveKey))?this._keypress(A,B):true},testEntry:function(C,A){var B=this.mask.options.maskArray;var D=this.globals.rules[B[C]];if(D.check){return(D&&D.regex.test(A)&&D.check(this.element.get("value"),C,A))}else{return(D&&D.regex.test(A))}},testEvents:function(B,F,C,E){var A=this.mask.options.maskArray;var D=this.globals.rules[A[B]];if(!E){if(!D){this.mask.fireEvent("overflow",[this.element,C,F]);return false}else{if(!this.testEntry(B,F)){this.mask.fireEvent("invalid",[this.element,C,F]);return false}}}this.mask.fireEvent("valid",[this.element,C,F]);return true}});Meio.MaskType.fixed=new Class({Extends:Meio.MaskType,options:{placeHolder:"_",removeIfInvalid:false},initialize:function(A){this.parent(A);this.maskMold=this.mask.options.mask.replace(this.globals.rulesRegex,this.options.placeHolder);this.maskMoldArray=this.maskMold.split("");this.validIndexes=[];this.mask.options.maskArray.each(function(C,B){if(this.globals.matchRules.contains(C)){this.validIndexes.push(B)}},this)},_paste:function(E,G){var F=this.element.get("value"),A=F.split(""),C=this.mask.options.maskArray;var B=0,D=G.range.start;while(B<this.maskMold.length){if(!A[B]){A[B]=this.maskMold[B]}else{if(this.globals.rules[C[B]]){if(!this.testEntry(B,A[B])){A.splice(B,1);continue}D=B}else{if(C[B]!=A[B]){A.splice(B,0,this.maskMold[B])}else{A[B]=this.maskMold[B]}}}B++}this.maskMoldArray=A.slice(0,this.maskMold.length);this.element.set("value",this.maskMoldArray.join("")).setRange(D+1);return false},_focus:function(A,B){this.element.set("value",this.maskMoldArray.join("")).store("meiomask:focusvalue",this.element.get("value")).select();return true},_blur:function(D,F){var E=this.element.get("value"),C=E.length-1,B=0,A;if(this.element.retrieve("meiomask:focusvalue")!=E){this.element.fireEvent("change")}if(this.mask.options.removeIfInvalid){if(E.contains(this.options.placeHolder)){this.maskMoldArray=this.maskMold.split("");this.element.set("value","")}return true}if(E==this.maskMold){this.element.set("value","")}else{while(C>=0){A=false;while(!this.globals.matchRules.contains(E.charAt(C))&&E.charAt(C)!=this.options.placeHolder){A=true;C--}if(A){while(E.charAt(C)==this.options.placeHolder){B=C;C--}}else{break}}if(B){this.element.set("value",E.substring(0,B))}}return true},_keypress:function(I,C){if(this.ignore||I.control||I.meta||I.alt){return true}var K=String.fromCharCode(I.code),D=this.mask.options.maskArray,B,E;if(!C.isSelection){if(C.isRemoveKey){if(C.isDelKey){do{B=this.validIndexes.indexOf(C.range.start++)}while(B==-1&&C.range.start<D.length)}else{do{B=this.validIndexes.indexOf(--C.range.start)}while(B==-1&&C.range.start>=0)}if(B==-1){return false}var L=B,E=this.validIndexes[L],J=this.validIndexes[L+1];if(!this.testEvents(E,K,I.code,C.isRemoveKey)){return false}while(L<=this.validIndexes.length&&J&&this.testEntry(E,this.maskMoldArray[J])){this.maskMoldArray[E]=this.maskMoldArray[J];E=this.validIndexes[L];J=this.validIndexes[++L]}this.maskMoldArray[E]=this.options.placeHolder;this.element.set("value",this.maskMoldArray.join("")).setRange(this.validIndexes[B])}else{do{B=this.validIndexes.indexOf(C.range.start++)}while(B==-1&&C.range.start<D.length);E=this.validIndexes[B];if(!this.testEvents(E,K,I.code,C.isRemoveKey)){return false}var F=[this.maskMoldArray[E]],L;this.maskMoldArray[E]=K;L=B+1;E=this.validIndexes[L];while(L<this.validIndexes.length&&this.testEntry(E,F[0])){F.unshift(this.maskMoldArray[E]);this.maskMoldArray[E]=F.pop();E=this.validIndexes[++L]}this.element.set("value",this.maskMoldArray.join(""));if(this.validIndexes[B+1]){this.element.setRange(this.validIndexes[B+1])}}}else{var A=C.range.start;var H=C.range.end;do{B=this.validIndexes.indexOf(C.range.start++)}while(B==-1&&C.range.start<D.length);do{end=this.validIndexes.indexOf(C.range.end++)}while(end==-1&&C.range.end<D.length);var M=end-B;if(M==0){return false}for(E=A;E<H;E++){this.maskMoldArray[E]=this.maskMold.charAt(E)}if(!C.isRemoveKey){E=this.validIndexes[B];if(!this.testEvents(E,K,I.code,C.isRemoveKey)){return false}this.maskMoldArray[E]=K;B++}M=end-B;if(M==0){this.element.set("value",this.maskMoldArray.join(""));this.element.setRange(this.validIndexes[B]);return false}L=end;var G=true,N;while((E=this.validIndexes[L])&&(this.maskMoldArray[E]!=this.options.placeHolder)){N=this.validIndexes[L-M];if(!this.testEntry(N,this.maskMoldArray[E])){G=false;break}L++}if(G){L=end;while((E=this.validIndexes[L])){N=this.validIndexes[L-M];this.maskMoldArray[N]=this.maskMoldArray[E];this.maskMoldArray[E]=this.options.placeHolder;L++}}this.element.set("value",this.maskMoldArray.join(""));this.element.setRange(this.validIndexes[B])}return false},__mask:function(A,B,C,D){return A.__mask(B,C,D).join("").substring(0,C.maskArray.length)}});Meio.MaskType.infinite=new Class({Extends:Meio.MaskType,_keyup:function(A,B){return true},_paste:function(A,B){this.$el.set("value",this.__mask(B.valueArray,this.globals,this.mask.options));return true},_keypress:function(C,D){if(this.ignore||C.control||C.meta||C.alt){return true}var E=String.fromCharCode(C.code),A=this.mask.options.maskArray,B=D.value.replace(this.globals.fixedCharsRegG,"").split("");if(!this.testEvents(A,0,E,C.code)){return false}this.$el.set("value",B.join(""));return true}});Meio.MaskType.reverse=new Class({Extends:Meio.MaskType,options:{alignText:true,decimal:true},initialize:function(A){this.parent(A);if(A){$extend(this.mask.options,this.options);this.mask.options.maskArray.reverse();if(this.mask.options.alignText){this.element.setStyle("text-align","right")}}},_paste:function(A,B){this.$el.set("value",this.__mask(B.valueArray,this.globals,this.mask.options));return true},_keypress:function(H,B){if(this.ignore||H.control||H.meta||H.alt){return true}var I=String.fromCharCode(H.code),K=B.range.start,F=B.value,A=this.mask.options,D=A.maskArray,E=F.substr(0,K),G=F.substr(B.range.end,F.length);F=(E+I+G);var J=F.replace(A.fixedCharsRegG,"").split(""),C=D.__extraPositionsTill(K,A.fixedCharsReg);B.rsEp=K+C;if(!this.testEvents(D,B.rsEp,I,H.code)){return false}this.$el.set("value",this.__mask(J,this.globals,A));if(Browser.Engine.trident&&((K==0&&B.range.end==0)||K!=B.range.end)){this.$el.setRange(B.value.length)}return false},__mask:function(B,C,E,A){B.reverse();var D=B.__mask(C,E).reverse();return D.join("").substring(D.length-E.maskArray.length)}});Meio.MaskType.regexp=new Class({Extends:Meio.MaskType,initialize:function(A){this.parent(A);this.regExp=new RegExp(this.mask.options.mask)},_keyup:function(A,B){return true},_paste:function(A,B){this.$el.set("value",this.regExp.test(B.value)?B.value:"");return true},_keypress:function(D,E){if(this.ignore||D.control||D.meta||D.alt){return true}var F=String.fromCharCode(D.code),C=E.value,B=C.substr(0,E.range.start),A=C.substr(E.range.end,C.length);C=(B+F+A);if(this.regExp.test(C)){this.mask.fireEvent("valid",[this.$el,F,D.code]);return true}else{this.mask.fireEvent("invalid",[this.$el,F,D.code]);return false}}});Element.implement({meiomask:function(A){return this.set("meiomask",A)},setRange:function(C,A){A=$pick(A,C);if(this.setSelectionRange){this.setSelectionRange(C,A)}else{var B=this.createTextRange();B.collapse();B.moveStart("character",C);B.moveEnd("character",A-C);B.select()}},getRange:function(){if(!Browser.Engine.trident){return{start:this.selectionStart,end:this.selectionEnd}}var B={start:0,end:0},A=document.selection.createRange();B.start=0-A.duplicate().moveStart("character",-100000);B.end=B.start+A.text.length;return B}});Element.Properties.meiomask={set:function(B){B=$pick(B,{});var A=this.retrieve("meiomask");return this.store("meiomask",A?A.change(B):new Meio.Mask(this,B))},get:function(){return this.retrieve("meiomask")},erase:function(){var A=this.retrieve("meiomask");if(A){A.remove()}return this}};Element.Properties.maxlength={set:function(A){this.setAttribute("maxLength",A);return this},get:function(){var A=this.getAttribute("maxLength",2);return(A==2147483647)?null:A},erase:function(){this.removeAttribute("maxLength");return this}};String.implement({mask:function(A){var C=Meio.MaskGlobals.get(),D={};switch($type(A)){case"string":if(C.masks[A]){$extend(D,C.masks[A])}else{D.mask=A}break;case"object":$extend(D,A)}if(!D.type){D.type="fixed"}var B=new Meio.MaskType[D.type]();return B.maskString(this)}})